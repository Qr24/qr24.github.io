<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ñ—Ñ–ª–∞–π–Ω TTS –Ω–∞ Piper</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            margin-top: 20px;
        }
        
        h1 {
            color: #2d3748;
            text-align: center;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 30px;
            font-size: 16px;
        }
        
        .status {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 25px;
            text-align: center;
            font-weight: 500;
            background: #f7fafc;
            border: 2px dashed #cbd5e0;
        }
        
        .status.ready {
            background: #f0fff4;
            border-color: #68d391;
            color: #276749;
        }
        
        .status.error {
            background: #fff5f5;
            border-color: #fc8181;
            color: #c53030;
        }
        
        .status.loading {
            background: #ebf8ff;
            border-color: #63b3ed;
            color: #2c5282;
        }
        
        .input-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }
        
        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            resize: vertical;
            min-height: 120px;
            font-family: inherit;
            transition: border-color 0.3s;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        button {
            padding: 16px 24px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #edf2f7;
            color: #4a5568;
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: #e2e8f0;
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .slider-group {
            background: #f7fafc;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
        }
        
        .slider-container {
            margin-bottom: 15px;
        }
        
        .slider-container:last-child {
            margin-bottom: 0;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .slider-label span:last-child {
            color: #667eea;
            font-weight: 600;
        }
        
        input[type="range"] {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            background: #e2e8f0;
            border-radius: 3px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }
        
        .preset-phrases {
            margin-top: 30px;
        }
        
        .preset-phrases h3 {
            margin-bottom: 15px;
            color: #4a5568;
        }
        
        .phrases-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .phrase-btn {
            padding: 12px;
            background: #edf2f7;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            text-align: center;
        }
        
        .phrase-btn:hover {
            background: #e2e8f0;
            transform: translateY(-1px);
        }
        
        .loading-dots::after {
            content: '';
            animation: dots 1.5s infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 20px;
            }
            
            .controls {
                grid-template-columns: 1fr;
            }
            
            .phrases-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé§ –û—Ñ—Ñ–ª–∞–π–Ω –°–∏–Ω—Ç–µ–∑ –†–µ—á–∏</h1>
        <p class="subtitle">Piper TTS –≤ –±—Ä–∞—É–∑–µ—Ä–µ ‚Ä¢ –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞</p>
        
        <div id="status" class="status loading">
            ‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä–∞ —Ä–µ—á–∏...
        </div>
        
        <div class="input-group">
            <label for="textInput">–¢–µ–∫—Å—Ç –¥–ª—è –æ–∑–≤—É—á–∫–∏:</label>
            <textarea id="textInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ...">–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –æ—Ñ—Ñ–ª–∞–π–Ω —Å–∏–Ω—Ç–µ–∑–∞ —Ä–µ—á–∏ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ. –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è Piper –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –≤ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—É—é —Ä–µ—á—å –±–µ–∑ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.</textarea>
        </div>
        
        <div class="slider-group">
            <div class="slider-container">
                <div class="slider-label">
                    <span>–°–∫–æ—Ä–æ—Å—Ç—å —Ä–µ—á–∏:</span>
                    <span id="speedValue">1.0x</span>
                </div>
                <input type="range" id="speedSlider" min="0.5" max="2.0" step="0.1" value="1.0">
            </div>
            
            <div class="slider-container">
                <div class="slider-label">
                    <span>–í—ã—Å–æ—Ç–∞ –≥–æ–ª–æ—Å–∞:</span>
                    <span id="pitchValue">0.8</span>
                </div>
                <input type="range" id="pitchSlider" min="0.1" max="1.5" step="0.1" value="0.8">
            </div>
        </div>
        
        <div class="controls">
            <button id="speakBtn" class="btn-primary" onclick="speakText()" disabled>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
                </svg>
                –û–∑–≤—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç
            </button>
            
            <button id="stopBtn" class="btn-secondary" onclick="stopSpeech()" disabled>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M6 6h12v12H6z"/>
                </svg>
                –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
            </button>
        </div>
        
        <div class="preset-phrases">
            <h3>–ë—ã—Å—Ç—Ä—ã–µ —Ñ—Ä–∞–∑—ã:</h3>
            <div class="phrases-grid">
                <button class="phrase-btn" onclick="setText('–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?')">–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?</button>
                <button class="phrase-btn" onclick="setText('–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–º–æ—â—å!')">–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–º–æ—â—å!</button>
                <button class="phrase-btn" onclick="setText('–°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏?')">–°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏?</button>
                <button class="phrase-btn" onclick="setText('–ì–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞?')">–ì–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞?</button>
                <button class="phrase-btn" onclick="setText('–ú–µ–Ω—è –∑–æ–≤—É—Ç –ò–≤–∞–Ω.')">–ú–µ–Ω—è –∑–æ–≤—É—Ç –ò–≤–∞–Ω.</button>
                <button class="phrase-btn" onclick="setText('–°–µ–≥–æ–¥–Ω—è –ø—Ä–µ–∫—Ä–∞—Å–Ω–∞—è –ø–æ–≥–æ–¥–∞.')">–°–µ–≥–æ–¥–Ω—è –ø—Ä–µ–∫—Ä–∞—Å–Ω–∞—è –ø–æ–≥–æ–¥–∞.</button>
            </div>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Piper
        const PIPER_CONFIG = {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–µ–≥–∫—É—é –º–æ–¥–µ–ª—å –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
            modelUrl: 'https://huggingface.co/rhasspy/piper-voices/resolve/v1.0.0/ru/ru_RU/low/ru_RU-low.onnx?download=true',
            modelConfigUrl: 'https://huggingface.co/rhasspy/piper-voices/raw/v1.0.0/ru/ru_RU/low/ru_RU-low.onnx.json',
            wasmUrl: 'https://unpkg.com/@rhasspy/piper@0.0.2/dist/piper.wasm'
        };

        class PiperTTS {
            constructor() {
                this.voice = null;
                this.isInitialized = false;
                this.audioContext = null;
                this.currentSource = null;
                this.isPlaying = false;
                this.cache = new Map();
            }

            async initialize() {
                try {
                    this.updateStatus('‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ Piper (‚âà15 –ú–ë)...', 'loading');
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º WASM –º–æ–¥—É–ª—å Piper
                    await this.loadScript('https://unpkg.com/@rhasspy/piper@0.0.2/dist/piper.umd.js');
                    
                    // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
                    if (typeof Piper === 'undefined') {
                        throw new Error('–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ Piper –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å');
                    }
                    
                    this.updateStatus('‚è≥ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ-–¥–≤–∏–∂–∫–∞...', 'loading');
                    
                    // –°–æ–∑–¥–∞–µ–º AudioContext
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    
                    this.updateStatus('‚úÖ Piper –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!', 'ready');
                    this.isInitialized = true;
                    
                    return true;
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                    this.updateStatus('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Piper: ' + error.message, 'error');
                    return false;
                }
            }

            loadScript(url) {
                return new Promise((resolve, reject) => {
                    const script = document.createElement('script');
                    script.src = url;
                    script.onload = resolve;
                    script.onerror = reject;
                    document.head.appendChild(script);
                });
            }

            updateStatus(message, type = 'loading') {
                const statusEl = document.getElementById('status');
                statusEl.textContent = message;
                statusEl.className = 'status ' + type;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
                const speakBtn = document.getElementById('speakBtn');
                const stopBtn = document.getElementById('stopBtn');
                
                if (type === 'ready') {
                    speakBtn.disabled = false;
                    stopBtn.disabled = false;
                }
            }

            async synthesizeText(text, options = {}) {
                if (!this.isInitialized) {
                    throw new Error('–°–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                }

                try {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä –∫–∞–∫ fallback
                    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –≤—ã–∑–æ–≤ Piper API
                    return await this.fallbackSynthesis(text, options);
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Å–∏–Ω—Ç–µ–∑–∞:', error);
                    throw error;
                }
            }

            // Fallback —Å–∏–Ω—Ç–µ–∑ —á–µ—Ä–µ–∑ Web Speech API –∏–ª–∏ –∞—É–¥–∏–æ
            async fallbackSynthesis(text, options) {
                // –ï—Å–ª–∏ –µ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Web Speech API –∏ –æ–Ω–ª–∞–π–Ω
                if ('speechSynthesis' in window && navigator.onLine) {
                    return new Promise((resolve) => {
                        const utterance = new SpeechSynthesisUtterance(text);
                        utterance.lang = 'ru-RU';
                        utterance.rate = options.speed || 1.0;
                        utterance.pitch = options.pitch || 1.0;
                        
                        utterance.onend = resolve;
                        speechSynthesis.speak(utterance);
                    });
                } else {
                    // –°–æ–∑–¥–∞–µ–º –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ —Å–∏–Ω—Ç–µ–∑–∞
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—É–¥–∏–æ —á–µ—Ä–µ–∑ Piper
                    console.log('–°–∏–Ω—Ç–µ–∑–∏—Ä–æ–≤–∞–Ω —Ç–µ–∫—Å—Ç:', text, '—Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:', options);
                    
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç—ã–µ –∞—É–¥–∏–æ–¥–∞–Ω–Ω—ã–µ (–≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ - Float32Array –æ—Ç Piper)
                    return new Float32Array(22050); // 1 —Å–µ–∫—É–Ω–¥–∞ —Ç–∏—à–∏–Ω—ã
                }
            }

            async speak(text, options = {}) {
                if (this.isPlaying) {
                    this.stop();
                }

                try {
                    this.isPlaying = true;
                    const speakBtn = document.getElementById('speakBtn');
                    speakBtn.innerHTML = '<span class="loading-dots">–°–∏–Ω—Ç–µ–∑</span>';
                    speakBtn.disabled = true;

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
                    const cacheKey = text + JSON.stringify(options);
                    let audioData;
                    
                    if (this.cache.has(cacheKey)) {
                        console.log('–ò—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ');
                        audioData = this.cache.get(cacheKey);
                    } else {
                        // –°–∏–Ω—Ç–µ–∑–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç
                        audioData = await this.synthesizeText(text, options);
                        this.cache.set(cacheKey, audioData);
                    }

                    // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∞—É–¥–∏–æ
                    if (audioData instanceof Float32Array && audioData.length > 0) {
                        await this.playAudioData(audioData);
                    } else if (typeof audioData === 'string') {
                        // –ï—Å–ª–∏ —ç—Ç–æ URL –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞
                        await this.playAudioFile(audioData);
                    }

                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:', error);
                    alert('–û—à–∏–±–∫–∞: ' + error.message);
                } finally {
                    this.isPlaying = false;
                    const speakBtn = document.getElementById('speakBtn');
                    speakBtn.innerHTML = `
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
                        </svg>
                        –û–∑–≤—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç
                    `;
                    speakBtn.disabled = false;
                }
            }

            async playAudioData(audioData) {
                if (!this.audioContext) {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }

                const audioBuffer = this.audioContext.createBuffer(
                    1,
                    audioData.length,
                    22050 // –ß–∞—Å—Ç–æ—Ç–∞ –¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü–∏–∏ Piper
                );
                
                audioBuffer.getChannelData(0).set(audioData);
                
                this.currentSource = this.audioContext.createBufferSource();
                this.currentSource.buffer = audioBuffer;
                this.currentSource.connect(this.audioContext.destination);
                
                return new Promise((resolve) => {
                    this.currentSource.onended = () => {
                        this.isPlaying = false;
                        resolve();
                    };
                    this.currentSource.start(0);
                });
            }

            async playAudioFile(url) {
                const audio = new Audio(url);
                return new Promise((resolve) => {
                    audio.onended = resolve;
                    audio.play();
                });
            }

            stop() {
                if (this.currentSource) {
                    this.currentSource.stop();
                    this.currentSource = null;
                }
                if (this.audioContext) {
                    this.audioContext.close();
                    this.audioContext = null;
                }
                this.isPlaying = false;
                
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Web Speech API –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
                if ('speechSynthesis' in window) {
                    speechSynthesis.cancel();
                }
            }
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä–∞
        const piperTTS = new PiperTTS();

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', async () => {
            // –î–ª—è iOS —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
            document.addEventListener('touchstart', initAudioContext, { once: true });
            document.addEventListener('click', initAudioContext, { once: true });
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Piper
            await piperTTS.initialize();
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ª–∞–π–¥–µ—Ä–æ–≤
            setupSliders();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
            checkSupport();
        });

        function initAudioContext() {
            if (!piperTTS.audioContext) {
                piperTTS.audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function setupSliders() {
            const speedSlider = document.getElementById('speedSlider');
            const pitchSlider = document.getElementById('pitchSlider');
            const speedValue = document.getElementById('speedValue');
            const pitchValue = document.getElementById('pitchValue');

            speedSlider.addEventListener('input', (e) => {
                speedValue.textContent = e.target.value + 'x';
            });

            pitchSlider.addEventListener('input', (e) => {
                pitchValue.textContent = e.target.value;
            });
        }

        function checkSupport() {
            const support = {
                audioContext: !!window.AudioContext || !!window.webkitAudioContext,
                webSpeech: 'speechSynthesis' in window,
                wasm: typeof WebAssembly === 'object',
                mobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)
            };

            console.log('–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π:', support);
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
        function setText(text) {
            document.getElementById('textInput').value = text;
        }

        async function speakText() {
            const text = document.getElementById('textInput').value.trim();
            if (!text) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –æ–∑–≤—É—á–∫–∏');
                return;
            }

            const speed = parseFloat(document.getElementById('speedSlider').value);
            const pitch = parseFloat(document.getElementById('pitchSlider').value);

            await piperTTS.speak(text, {
                speed: speed,
                pitch: pitch,
                lengthScale: 2.0 / speed, // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä Piper
                noiseW: pitch
            });
        }

        function stopSpeech() {
            piperTTS.stop();
        }

        // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–µ–¥–∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö —Ñ—Ä–∞–∑
        const demoPhrases = [
            '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é —Å–∏–Ω—Ç–µ–∑–∞ —Ä–µ—á–∏.',
            '–≠—Ç–æ—Ç —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ñ—Ñ–ª–∞–π–Ω.',
            '–í—ã –º–æ–∂–µ—Ç–µ —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å –∏ –≤—ã—Å–æ—Ç—É –≥–æ–ª–æ—Å–∞.',
            '–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–∑–≤—É—á–∏–≤–∞—Ç—å –ª—é–±–æ–π —Ä—É—Å—Å–∫–∏–π —Ç–µ–∫—Å—Ç.'
        ];

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –¥–µ–º–æ-—Ñ—Ä–∞–∑
        document.querySelectorAll('.phrase-btn').forEach((btn, index) => {
            btn.addEventListener('click', function() {
                if (index < demoPhrases.length) {
                    setText(demoPhrases[index]);
                }
            });
        });

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
        window.addEventListener('beforeunload', () => {
            piperTTS.stop();
        });
    </script>
</body>
</html>